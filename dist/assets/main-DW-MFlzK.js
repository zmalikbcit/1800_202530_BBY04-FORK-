import{o as I}from"./bootstrap.esm-BEI9jhF-.js";import{a as y,g as w,c as l,d as u,q as E,l as j,w as B,b as A,s as x,u as N,e as b}from"./firebaseConfig-D3CXmay8.js";const L=document.getElementById("alerts");function d(e,o="success"){const t=document.createElement("div");t.className=`alert alert-${o}`,t.textContent=e,L?.appendChild(t),setTimeout(()=>t.remove(),4e3)}function m(e,o){e&&(e.disabled=!!o,e.dataset._orig=e.dataset._orig||e.textContent,e.textContent=o?"Please wait...":e.dataset._orig)}function p(e){return(e||"").toString().trim().toLowerCase().replace(/[^a-z0-9-]+/g,"-").replace(/^-+|-+$/g,"").replace(/--+/g,"-").slice(0,40)}async function g(){const e=document.getElementById("my-groups");if(!e)return;e.innerHTML="";const o=y.currentUser;if(!o)return;const t=await w(l(u,"groups")),a=[];if(t.forEach(r=>{const n=r.data();if(n.deletedAt)return;Array.isArray(n.users)&&n.users.some(s=>s?.uid===o.uid)&&a.push({id:r.id,...n})}),a.length===0){const r=document.createElement("li");r.className="list-group-item",r.textContent="You haven't joined any groups yet.",e.appendChild(r);return}for(const r of a){const n=document.createElement("li");n.className="list-group-item d-flex justify-content-between align-items-center",n.innerHTML=`<a href="/myGroup.html?docID=${r.id}">${r.name}</a>`,e.appendChild(n)}}async function C(e,o){const t=y.currentUser;if(!t)throw new Error("You must be signed in.");const a=document.getElementById("create-group-joinkey")?.value?.trim(),r=p(a||e);if(!e)throw new Error("Group name is required.");if(!o)throw new Error("Password is required.");if(!r)throw new Error("Join name is required.");const n=E(l(u,"groups"),B("joinKey","==",r),j(1));if(!(await w(n)).empty)throw new Error("That join name is already taken. Try another.");const s={uid:t.uid,displayName:t.displayName||t.email||"Owner",email:t.email||"",photoURL:t.photoURL||"",joinedAt:Date.now()};await A(l(u,"groups"),{name:e,joinKey:r,password:o,createdAt:x(),ownerUid:t.uid,users:[s]})}async function D(e,o){const t=y.currentUser;if(!t)throw new Error("You must be signed in.");const a=(e||"").trim(),r=o||"",n=p(a);if(!n)throw new Error("Please enter the group's join name.");if(!r)throw new Error("Please enter the group password.");const i=E(l(u,"groups"),B("joinKey","==",n),j(1)),s=await w(i);if(s.empty)throw new Error("No group with that join name.");const f=s.docs[0],c=f.data();if(c.deletedAt)throw new Error("This group has been deleted.");if(c.password!==r)throw new Error("Incorrect password.");if(Array.isArray(c.users)&&c.users.some(v=>v?.uid===t.uid))return;const h=Array.isArray(c.users)?c.users.slice():[];h.push({uid:t.uid,displayName:t.displayName||t.email||"Member",email:t.email||"",photoURL:t.photoURL||"",joinedAt:Date.now()}),await N(b(u,"groups",f.id),{users:h})}function K(){const e=document.getElementById("create-group-form"),o=document.getElementById("create-group-btn");e?.addEventListener("submit",async r=>{r.preventDefault();const n=document.getElementById("create-group-name")?.value.trim()||"",i=document.getElementById("create-group-password")?.value;m(o,!0);try{await C(n,i),d(`Group "${n}" created.`,"success"),await g(),e.reset()}catch(s){console.error(s),d(s.message||"Failed to create group.","danger")}finally{m(o,!1)}});const t=document.getElementById("join-group-form"),a=document.getElementById("join-group-btn");t?.addEventListener("submit",async r=>{r.preventDefault();const n=document.getElementById("join-group-name")?.value.trim()||"",i=document.getElementById("join-group-password")?.value;m(a,!0);try{await D(n,i),d(`Joined "${n}".`,"success"),await g(),t.reset()}catch(s){console.error(s),d(s.message||"Failed to join group.","danger")}finally{m(a,!1)}})}function U(){const e=document.getElementById("name-goes-here");I(async o=>{if(!o){location.href="index.html";return}const t=o.displayName||o.email;e&&(e.textContent=`${t}!`),K(),await g()})}U();
